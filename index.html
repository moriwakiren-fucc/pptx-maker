<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>pptxgenjs 両対応ランナー</title>

<!-- ブラウザ用 pptxgenjs -->
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

<style>
body {
  font-family: sans-serif;
  padding: 20px;
}
textarea {
  width: 100%;
  height: 260px;
}
button {
  margin-top: 10px;
  padding: 8px 16px;
}
pre {
  background: #f4f4f4;
  padding: 10px;
}
</style>
</head>

<body>
<h2>pptxgenjs コード実行（Node / Browser 両対応）</h2>

<textarea id="code">
// Node.js 用でもブラウザ用でもOK
const pptx = new pptxgen();
const slide = pptx.addSlide();
slide.addText("Hello PPTX", { x: 1, y: 1, fontSize: 24 });
pptx.writeFile({ fileName: "sample.pptx" });
</textarea>

<br />
<button onclick="runCode()">実行</button>

<pre id="log"></pre>

<script>
function runCode() {
  const log = document.getElementById("log");
  log.textContent = "";

  try {
    /* ===============================
       ① Node.js 環境のエミュレーション
    =============================== */

    // require を偽装
    window.require = function (name) {
      if (name === "pptxgenjs") {
        return PptxGenJS;
      }
      throw new Error("Module not found: " + name);
    };

    // Node.js 風クラス名の吸収
    window.pptxgen = function () {
      return new PptxGenJS();
    };

    /* ===============================
       ② writeFile の吸収
    =============================== */

    const originalWriteFile = PptxGenJS.prototype.writeFile;
    PptxGenJS.prototype.writeFile = function (arg) {
      if (typeof arg === "object" && arg.fileName) {
        return originalWriteFile.call(this, arg.fileName);
      }
      return originalWriteFile.call(this, arg);
    };

    /* ===============================
       ③ ユーザーコード実行
    =============================== */

    const userCode = document.getElementById("code").value;
    new Function(userCode)();

    log.textContent = "✅ 実行成功（ダウンロードが始まります）";
  } catch (e) {
    log.textContent = "❌ エラー\n" + e.message;
    console.error(e);
  }
}
</script>
</body>
</html>
